<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Test" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  
  <PropertyGroup>
    <MSBuildCommunityTasksPath>c:\dev\bin\MSBuildCommunity\Build</MSBuildCommunityTasksPath>
    <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
    <ClassLibraryOutputDirectory>bin\$(Configuration)</ClassLibraryOutputDirectory>    
    <MainProject>SPSProfessional.SharePoint.Framework</MainProject>
    <MainLibraryOutputDirectory>..\$(MainProject)\bin\$(Configuration)</MainLibraryOutputDirectory>
    <ProjectTestDir>.</ProjectTestDir >
    <ProjectFile>..\$(MainProject)\$(MainProject).csproj</ProjectFile >
    <TestProjectFile>$(MainProject).Tests.csproj</TestProjectFile >
    <CmdNUnit>c:\dev\bin\nunit\bin\nunit-console.exe</CmdNUnit>
    <CmdFxCop>c:\dev\bin\fxcop\fxcopcmd.exe</CmdFxCop>
  </PropertyGroup>

  <!-- Import the MSBuild Tasks -->
  <Import Project="$(MSBuildCommunityTasksPath)\MSBuild.Community.Tasks.Targets"/>

  <!-- Build projects by calling the Project files generated by VS -->
  <Target Name="Build">
    <MSBuild Projects="$(ProjectFile)" Targets="Clean;Rebuild" Properties="Configuration=Debug;WarningLevel=3" />
    <MSBuild Projects="$(TestProjectFile)" Targets="Clean;Rebuild" Properties="Configuration=Debug;WarningLevel=1" />
  </Target>

  <!-- Run Unit tests -->
  <Target Name="Test" DependsOnTargets="Build">
    <CreateItem Include="$(ClassLibraryOutputDirectory)\*.Tests.dll">
      <Output TaskParameter="Include" ItemName="TestAssembly" />
    </CreateItem>
    <Exec Command="$(CmdNUnit) @(TestAssembly) /xml=../Artifact/nunit-results.xml /exclude=TypeMock" 
          IgnoreExitCode="false" />
  </Target>

  <!-- Run FxCop tests -->
  <Target Name="FxCop" DependsOnTargets="Test">
    <CreateItem Include="$(MainLibraryOutputDirectory)\$(MainProject).dll">
      <Output TaskParameter="Include" ItemName="TestAssembly" />
    </CreateItem>
    <Exec Command="$(CmdFxCop) /p:FxCop.FxCop /out:../Artifact/fxcop-results.xml"
          IgnoreExitCode="true" />
  </Target>    
  
</Project>